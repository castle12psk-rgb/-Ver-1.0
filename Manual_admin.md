# GIDS 관리자 모드 상세 명세서

---

## Part 1: 관리자 기능 매뉴얼

### 1. 개요

GIDS(해외감염병 감시 솔루션)의 관리자 모드는 시스템의 전반적인 상태를 모니터링하고, 데이터 수집부터 AI 검증 규칙, 사용자 접근 제어에 이르기까지 시스템의 모든 핵심 요소를 설정하고 관리하기 위한 전문가용 인터페이스입니다. 본 매뉴얼은 각 기능의 상세한 사용법을 안내합니다.

### 2. 관리자 대시보드 (`/admin/dashboard`)

시스템의 모든 핵심 지표와 상태를 한눈에 파악할 수 있는 통합 관제실입니다.

**화면 구성 및 기능:**

1.  **핵심 성과 지표(KPI) 카드:**
    *   **시스템 상태:** 전체 시스템(서버, DB, AI 모듈)의 정상 작동 여부를 표시합니다. `정상` 또는 `오류`로 표시됩니다.
    *   **활성 사용자:** 현재 시스템에 로그인하여 활동 중인 사용자 수입니다.
    *   **CPU 사용량:** 시스템의 주 서버 CPU 사용률을 실시간으로 보여줍니다.
    *   **보안 이벤트 (24h):** 최근 24시간 내 발생한 비정상 로그인 시도, DDoS 공격 등 보안 관련 이벤트 수입니다.

2.  **AI 검증 시스템 현황:**
    *   최근 24시간 동안 AI가 검증을 완료한 정보의 통계를 `사실`, `허위`, `의견`, `수동 검토 필요` 네 가지 유형으로 분류하여 보여줍니다. 관리자는 이를 통해 AI의 판정 경향을 파악할 수 있습니다.

3.  **최근 시스템 로그:**
    *   사용자 로그인, 크롤러 작동, 오류 발생 등 시스템의 주요 활동 로그를 최신순으로 표시합니다. 시스템 장애 발생 시 빠른 원인 파악에 사용됩니다.

4.  **데이터 소스 크롤링 현황 (위젯):**
    *   `데이터 소스 관리` 페이지의 핵심 정보를 요약하여 보여줍니다.
    *   각 데이터 소스의 이름, 현재 상태, 24시간 내 수집 문서 수, 그리고 최근 7일간의 수집량 추이를 보여주는 스파크라인 차트를 제공합니다.
    *   `전체 보기` 링크를 클릭하면 상세 관리 페이지로 이동합니다.

5.  **AI 검증 대기 목록 (위젯):**
    *   `AI 검증 관리` 페이지의 핵심 정보인 수동 검토 대기 목록을 요약하여 보여줍니다.
    *   AI가 자동으로 판정하기 어려워 관리자의 개입이 필요한 정보 목록과 AI의 신뢰도 점수를 시각화된 막대 그래프로 표시합니다.
    *   `전체 보기` 링크를 클릭하면 상세 검증 페이지로 이동합니다.

### 3. 데이터 소스 관리 (`/admin/collection`)

전 세계 웹에서 감염병 정보를 수집하는 지능형 크롤러(Crawler)를 생성, 수정, 삭제하고 작동 상태를 제어하는 페이지입니다.

**화면 구성 및 기능:**

1.  **요약 KPI 카드:**
    *   **총 데이터 소스:** 등록된 전체 크롤러 수.
    *   **활성/활성화:** 현재 `활성화` 상태인 크롤러 수.
    *   **24시간 내 수집량:** 모든 크롤러가 24시간 동안 수집한 총 문서 수.
    *   **오류 발생:** 현재 `Error` 상태인 크롤러 수.

2.  **신규 소스 추가:**
    *   버튼 클릭 시, 새로운 데이터 소스를 등록하는 모달(팝업창)이 열립니다.
    *   **입력 항목:** 소스 이름, URL/API 엔드포인트, 소스 타입(Web Page, API, RSS Feed), 수집 주기(5분, 1시간 등)를 설정할 수 있습니다.

3.  **데이터 소스 목록:**
    *   **활성화 (Toggle Switch):** 각 크롤러의 작동 여부를 즉시 켜거나 끌 수 있습니다.
    *   **데이터 소스:** 크롤러의 이름과 대상 URL을 표시합니다.
    *   **최근 7일 수집량:** 스파크라인 차트를 통해 지난 7일간의 일별 데이터 수집량 추이를 시각적으로 보여줍니다.
    *   **상태:** `Active`(정상), `Warning`(일시적 오류), `Error`(실패), `Running...`(실행 중) 상태를 표시합니다.
    *   **작업 (Actions):** 각 항목의 맨 오른쪽에 위치한 메뉴 버튼을 통해 다음 작업을 수행할 수 있습니다.
        *   **즉시 실행:** 스케줄과 상관없이 해당 크롤러를 즉시 실행시킵니다.
        *   **수정:** 기존 크롤러의 설정(URL, 수집 주기 등)을 변경합니다.
        *   **삭제:** 해당 크롤러를 시스템에서 영구적으로 삭제합니다.

### 4. AI 검증 관리 (`/admin/verification`)

AI의 정보 검증 과정을 미세 조정하고, AI가 판단을 유보한 정보를 수동으로 검토하여 최종 판정을 내리는 페이지입니다.

**화면 구성 및 기능:**

1.  **KPI 카드:**
    *   **수동 검토 대기 건수:** 관리자의 최종 판정을 기다리는 정보의 수입니다.
    *   **AI 정확도 (24h):** 관리자가 수동으로 판정한 결과와 AI의 1차 분석 결과가 일치한 비율을 보여줍니다.
    *   **지식 베이스 문서 수:** AI가 사실 여부 판단 시 근거로 참조하는 내부 데이터베이스(RAG 소스)의 총 문서 수입니다.

2.  **수동 검토 대기 목록:**
    *   AI 신뢰도가 설정된 임계값보다 낮아 자동 판정이 보류된 정보 목록입니다.
    *   **AI 신뢰도:** 신뢰도 점수를 시각적인 막대 그래프와 함께 표시하여 관리자가 우선순위를 정하는 데 도움을 줍니다.
    *   `검토` 버튼 클릭 시, **수동 검증 모달**이 열립니다.
        *   **수동 검증 모달:** 원본 정보의 전체 텍스트, AI의 1차 분석 결과, RAG가 참조한 근거 데이터 요약을 한 화면에서 보여줍니다. 관리자는 이를 종합적으로 검토한 후 `사실`, `허위`, `의견` 중 최종 판정을 내립니다.

3.  **지식 베이스 관리 (RAG 소스):**
    *   AI가 팩트체크를 위해 사용하는 신뢰도 높은 데이터 소스(예: WHO 보고서 DB, CDC 공식 발표 자료 등)의 목록과 상태를 관리합니다.
    *   `전체 재인덱싱` 버튼: 모든 지식 베이스의 최신 정보를 다시 읽어 들여 AI가 최신 근거를 바탕으로 판단할 수 있도록 벡터 데이터베이스를 업데이트하는 중요한 기능입니다.

4.  **AI 모델 및 규칙 설정:**
    *   **수동 검토 신뢰도 임계값:** AI의 판단 신뢰도가 이 슬라이더로 설정된 값 미만일 경우, 자동으로 수동 검토 목록으로 보내도록 기준을 설정합니다.
    *   **활성 검증 규칙:** AI가 검증 시 사용하는 특정 규칙(예: '특정 출처 신뢰도 가중치 부여', '선정적 언어 탐지 패턴')을 켜거나 끌 수 있습니다.

### 5. 시스템 설정 (`/admin/settings`)

시스템의 사용자 계정, 접근 권한, 알림 등 전반적인 환경을 설정하는 페이지입니다.

**화면 구성 및 기능:**

1.  **사용자 관리:**
    *   시스템에 접근할 수 있는 사용자를 추가, 수정, 삭제합니다.
    *   사용자별로 역할을 부여하여 접근 권한을 제어할 수 있습니다.
        *   `Admin`: 모든 관리자 메뉴 접근 가능
        *   `Editor`: 수동 검증 등 데이터 관리 작업 가능
        *   `Viewer`: 데이터 조회만 가능

2.  **AI 검증 규칙 관리:**
    *   `AI 검증 관리` 페이지에 표시되는 규칙의 내용을 직접 생성하고 수정할 수 있습니다.

3.  **API 키 관리:**
    *   시스템이 외부 서비스(예: 지도 API, 번역 API)와 연동하기 위해 사용하는 API 키를 안전하게 관리합니다.

4.  **알림 설정:**
    *   시스템에 심각한 오류가 발생하거나 특정 조건(예: '고위험' 등급 감염병 발생)이 충족될 경우, 지정된 이메일 또는 슬랙 채널로 자동 알림을 보내도록 설정합니다.

---

## Part 2: 관리자 시스템 개발 스펙

### 1. 시스템 아키텍처

-   **MSA (마이크로서비스 아키텍처):** 관리자 기능은 별도의 `Admin Service`로 분리하여 사용자 서비스와의 독립성을 확보하고, 각 기능(사용자, 크롤러, AI 설정)별로 API 엔드포인트를 모듈화하여 관리합니다.
-   **비동기 작업 처리:** 크롤러 실행, 지식 베이스 재인덱싱 등 시간이 오래 걸리는 작업은 `Celery`와 같은 분산 작업 큐 시스템을 통해 비동기적으로 처리하여 UI의 응답성을 보장합니다.

### 2. 기술 스택 (Technology Stack)

| 구분 | 기술 | 세부 내용 및 사유 |
| :--- | :--- | :--- |
| **프론트엔드** | React, TypeScript | 컴포넌트 기반 아키텍처와 타입 안정성을 통해 복잡한 관리자 UI의 생산성과 유지보수성 극대화. |
| **백엔드** | **Python, FastAPI** | 비동기 처리를 통한 고성능 API 서버 구축. AI/ML 생태계와의 완벽한 호환성 및 빠른 개발 속도. |
| **데이터베이스** | **PostgreSQL** | 사용자, 크롤러 설정, AI 규칙 등 정형 데이터의 안정적인 저장 (ORM: SQLAlchemy). |
| | **Redis** | API 응답 캐싱, Celery 메시지 브로커, 실시간 대시보드 데이터 임시 저장 등 다용도로 활용. |
| | **Elasticsearch** | 시스템 전반의 로그 데이터를 수집하고, 전문 검색 및 분석을 지원. |
| **인프라**| Docker, Kubernetes | 모든 서비스를 컨테이너화하여 일관된 개발/운영 환경을 구축하고, Kubernetes를 통해 무중단 배포, 자동 확장(Auto-scaling), 리소스 관리. |
| | **AWS/GCP** | 관리형 서비스(RDS for PostgreSQL, ElastiCache for Redis, EKS/GKE for Kubernetes)를 활용하여 인프라 관리 부담 최소화. |
| **모니터링** | Prometheus, Grafana | 각 마이크로서비스의 핵심 메트릭(CPU, 메모리, API 응답 시간)을 수집하고, Grafana를 통해 시각화하여 관리자 대시보드에 일부 데이터를 제공. |
| **CI/CD** | GitHub Actions | 코드 push 시 자동으로 테스트, 빌드, 컨테이너 이미지 생성, Kubernetes 클러스터에 배포하는 파이프라인 구축. |

### 3. 핵심 기능 개발 프로세스

#### a. RAG 지식 베이스 재인덱싱 프로세스

1.  **Trigger:** 관리자가 `전체 재인덱싱` 버튼 클릭. 프론트엔드는 백엔드 API (`POST /api/admin/rag/reindex`) 호출.
2.  **Task Queuing:** 백엔드(FastAPI)는 요청을 받으면 즉시 `202 Accepted` 응답을 반환하고, `Celery`에 'reindex_knowledge_base' 작업을 전달.
3.  **Async Execution (Celery Worker):**
    a. 작업 수행 워커가 지식 베이스 소스(S3, 외부 DB 등)에서 최신 문서 목록을 가져옴.
    b. 각 문서를 `LangChain`의 `DocumentLoader`와 `TextSplitter`를 이용해 의미 있는 단위(Chunk)로 분할.
    c. 분할된 각 Chunk를 `Sentence-BERT`와 같은 임베딩 모델을 통해 고차원 벡터로 변환.
    d. 변환된 벡터와 원본 텍스트(메타데이터 포함)를 `Pinecone`, `ChromaDB` 같은 Vector DB에 Upsert(Update+Insert).
    e. 작업 완료 후, PostgreSQL에 저장된 각 지식 베이스의 '최근 업데이트' 시각을 갱신.
4.  **Status Update:** 프론트엔드는 재인덱싱 작업이 진행되는 동안 주기적으로 상태 API(`GET /api/admin/rag/status`)를 폴링하여 UI(예: '인덱싱 중...')를 업데이트.

#### b. 사용자 관리 및 인증/인가 (RBAC)

1.  **Authentication:** `JWT (JSON Web Token)` 기반 인증 사용.
    *   사용자가 로그인하면, 백엔드는 암호화된 JWT(사용자 ID, 역할, 만료 시간 포함)를 발급.
    *   프론트엔드는 이 토큰을 `localStorage` 또는 `httpOnly` 쿠키에 저장하고, 이후 모든 API 요청 헤더(`Authorization: Bearer <token>`)에 담아 전송.
2.  **Authorization (RBAC - Role-Based Access Control):**
    *   API 서버(FastAPI)는 미들웨어를 통해 모든 요청의 JWT를 검증.
    *   토큰에서 사용자 역할(`Admin`, `Editor` 등)을 추출.
    *   각 API 엔드포인트에 필요한 권한을 데코레이터 등으로 명시 (`@require_role('Admin')`).
    *   사용자의 역할이 해당 엔드포인트에 필요한 권한과 일치하지 않으면 `403 Forbidden` 에러를 반환.
```